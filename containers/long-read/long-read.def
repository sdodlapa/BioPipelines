Bootstrap: localimage
From: /home/sdodl001_odu_edu/BioPipelines/containers/images/base_1.0.0.sif

%labels
    org.opencontainers.image.version="1.0.0"
    org.opencontainers.image.authors="BioPipelines Team"
    org.opencontainers.image.title="BioPipelines Long-Read Container"
    org.opencontainers.image.description="Long-read sequencing analysis with Minimap2, Canu, Flye, and Nanopore tools"
    pipeline.name="long-read"
    pipeline.version="1.0.0"

%files
    entrypoint.sh /opt/biopipelines/entrypoint.sh
    run_pipeline.sh /opt/biopipelines/run_pipeline.sh

%post
    # Install long-read specific tools
    micromamba install -y -n base -c conda-forge -c bioconda \
        minimap2=2.28 \
        flye=2.9.5 \
        canu=2.2 \
        medaka \
        nanoplot \
        nanoqc=0.9.4 \
        filtlong=0.2.1 \
        porechop=0.2.4 \
        racon=1.5.0 \
        nanopolish \
        pomoxis \
        assembly-stats=1.0.1 \
        quast=5.2.0 \
        busco=5.8.0 \
        biopython

    # Make scripts executable
    chmod +x /opt/biopipelines/entrypoint.sh /opt/biopipelines/run_pipeline.sh
    
    # Create pipeline directory
    mkdir -p /opt/biopipelines/long_read

    # Clean up
    micromamba clean --all --yes

%environment
    export PIPELINE_NAME="long-read"
    export PIPELINE_VERSION="1.0.0"

%runscript
    exec /opt/biopipelines/entrypoint.sh "$@"

%test
    # Test long-read tools
    minimap2 --version
    flye --version
    NanoPlot --version
    echo "Long-read container validation passed"
