Bootstrap: localimage
From: /scratch/sdodl001/containers/base_1.0.0.sif

%labels
    org.opencontainers.image.title="BioPipelines RNA-seq Pipeline"
    org.opencontainers.image.description="Complete RNA-seq analysis from FASTQ to differential expression"
    org.opencontainers.image.version="1.0.0"
    org.opencontainers.image.authors="BioPipelines Team <sdodlapa@github>"
    ai.agent.category="transcriptomics"
    ai.agent.tier="pipeline"

%files
    entrypoint.sh /opt/biopipelines/entrypoint.sh
    run_pipeline.sh /opt/biopipelines/run_pipeline.sh

%post
    # Install RNA-seq specific tools (versions compatible with Python 3.11)
    micromamba install -y -n base -c conda-forge -c bioconda \
        fastp=0.23.4 \
        trimmomatic=0.39 \
        cutadapt \
        star=2.7.11a \
        hisat2=2.2.1 \
        salmon=1.10.3 \
        subread=2.0.6 \
        htseq \
        r-base=4.3 \
        bioconductor-deseq2 \
        bioconductor-edger \
        bioconductor-limma \
        r-ggplot2 \
        r-pheatmap \
        r-rcolorbrewer \
        r-tidyverse \
        && micromamba clean --all --yes
    
    # Make scripts executable
    chmod +x /opt/biopipelines/*.sh
    
    # Create pipeline directory
    mkdir -p /opt/biopipelines/rna_seq

%environment
    export PIPELINE_NAME="rna-seq"
    export PIPELINE_VERSION="1.0.0"
    export PATH="/opt/conda/bin:$PATH"

%runscript
    exec /opt/biopipelines/entrypoint.sh "$@"

%test
    fastqc --version
    star --version
    salmon --version
    echo "RNA-seq container validation passed"
