Bootstrap: localimage
From: /scratch/sdodl001/containers/base_1.0.0.sif

%labels
    org.opencontainers.image.version="1.0.0"
    org.opencontainers.image.authors="BioPipelines Team"
    org.opencontainers.image.title="BioPipelines ATAC-seq Container"
    org.opencontainers.image.description="ATAC-seq analysis pipeline with accessibility analysis and footprinting tools"
    pipeline.name="atac-seq"
    pipeline.version="1.0.0"

%files
    entrypoint.sh /opt/biopipelines/entrypoint.sh
    run_pipeline.sh /opt/biopipelines/run_pipeline.sh

%post
    # Install ATAC-seq specific tools (common tools now in base)
    micromamba install -y -n base -c conda-forge -c bioconda \
        macs2=2.2.9.1 \
        deeptools=3.5.5 \
        genrich=0.6.1 \
        ucsc-bedgraphtobigwig \
        homer=4.11 \
        ataqv=1.3.1 \
        bioconductor-chromvar \
        bioconductor-motifmatchr \
        bioconductor-tfbstools

    # Make scripts executable
    chmod +x /opt/biopipelines/entrypoint.sh /opt/biopipelines/run_pipeline.sh
    
    # Create pipeline directory
    mkdir -p /opt/biopipelines/atac_seq

    # Clean up
    micromamba clean --all --yes

%environment
    export PIPELINE_NAME="atac-seq"
    export PIPELINE_VERSION="1.0.0"

%runscript
    exec /opt/biopipelines/entrypoint.sh "$@"

%test
    # Test ATAC-seq tools
    bowtie2 --version | head -1
    macs2 --version
    genrich -h 2>&1 | head -1 || true
    deeptools --version
    echo "ATAC-seq container validation passed"
